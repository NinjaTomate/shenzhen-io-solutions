# Input variables
X_RADIO_RX

# Output variables
X_FISH
P_RICE
P_GATE_A
P_GATE_B
P_GATE_C

# Gist
Receive order
  Assemble sushi
    100 rice
    Fish signal
    30 rice
  Assume sushi is moving on conveyor belt
  Arrives at gate A in 3 units
  Arrives at gate B in 3 units
  Arrives at gate C in 3 units

Need to handle gates opening/closing concurrently.
  Probably via a queue system and each of the gate controllers sleep?
  Can't use the same controller and sleep for all of them due to potential lagged timings
  Maybe something with decrementing

Tables feel like a tree but we can also consider bitmasked values in binary

1 = 100, 100, 100
2 = 100, 100,   0
3 = 100,   0, 100
4 = 100,   0,   0
5 =   0, 100, 100
6 =   0, 100,   0
7 =   0,   0, 100
8 =   0,   0,   0

Sooo for gate A:

If > 4:
  # 1,2,3,4 -> 1,2,3,4
  - Move 100
  # 5,6,7,8 -> 1,2,3,4
  + Subtract 4
  + Move 0

Gate B:

If > 2
  # 1,2 -> 1,2
  - Move 100
  # 3,4 -> 1,2
  + Subtract 2
  + Move 0

Gate C:

If > 1
  # 1
  - Move 100
  # 2
  + Move 0

# Proof of concept stages

- Rice maker
- Queue layout

# Proof of concept rice maker
I'm a little worried that we will be sleeping for a order packet but it looks like we should be fine...

Logic (MC6000):

```
# Save incoming packet for inspection
mov x0 acc

# If the packet was junk, ignore it
teq acc -999
+ jmp slp

# Otherwise, save remainder of request
mov x0 dat

# Output 100 rice for 1s
gen p1 1 0

# Output fish type
mov acc x3

# Output 30 rice for 1s
mov 30 p1
slp 1
mov 0 p1

# Output table for order
mov dat x1

# Sleep
# TODO: If we do oversleep, maybe jump to `mov x0 acc` for even faster resolution?
slp: slp 1
```

# Queue system
We are thinking 3 controllers are ideal but maybe maybe not
  We could use 1 controller as long as it has a DX300

We are thinking output table value every 1s in RAM
  so basically `add 3` to figure out where reader will be
  Not sure how that works in reality though...

  Also what about multiple tables. We could do `dgt` stacking but that is going to be save position, read, reset position, write

  I think we have to though...

  Let's explore

We have some code for writing first digit but realizing that either writer needs to set up all 3 positions OR reader needs to read then write adjusted value 3 ahead
  Maybe we get a third controller on a double `slx` to write next ones?

```
mov x0 acc
teq acc -999
  # NEW: Tell writer about no table
+ mov 0 x1
+ jmp slp
mov x0 dat

# NEW: Tell writer about no table
mov 0 x1
gen p1 1 0
mov acc x3
mov 30 p1

# NEW: Tell writer about no table
mov 0 x1
slp 1
mov 0 p1
mov dat x1
slp: slp 1
```

```
# Move ourselves to 3rd position in RAM
@mov 3 x3

# Save current RAM position
mov x3 dat

# Save RAM value to acc
mov x2 acc

# Add table to 0th digit (autoincrements RAM)
# 20 + 8 -> 28
dst 0 x0

# Overwrite position with new data
mov dat x3
mov acc x2

# Tell reader it's free to read now
mov 100 x1

# Sleep
slp: slp 1
```

Tried to add updater controller but the sub logic get complex fast so we are attempting to us a calculator

```
slx x0
mov x2 dat
mov x3 acc
sub 4
mul 10
mov dat x2
mov acc x3
mov x2 dat
mov x3 acc
sub 20
mul 10
mov dat x2
mov acc x3
mov 0 x3
```

Started exploring reader part but realizing we will need something to read different parts

Also the gates are motors so we can't use a DX300. We'll need 3 controllers or some shared logic

Layout kind of sucks without knowing what we're building

Let's proof of concept a reader with values input by a controller
